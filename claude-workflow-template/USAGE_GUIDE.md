# Claude Code 工作流系统使用指南 (增强版)

## 🎯 系统概述

这套工作流系统基于"深度讨论-规划确认-自动执行-质量验收"的四阶段理念，专为Claude Code设计，适用于长时间(24H+)、复杂的项目自动化执行。集成了智能重试、异常恢复和实时监控系统。

## 🚀 5分钟快速上手

### 步骤1: 复制模板和准备环境
```bash
# 在你的项目根目录下执行
cp -r claude-workflow-template/template-docs/ ./
cp -r claude-workflow-template/scripts/ ./

# 创建必要的目录
mkdir -p STATE_BACKUPS ERROR_REPORTS QUALITY_REPORTS logs

# 设置脚本执行权限
chmod +x scripts/*.sh
```

### 步骤2: 启动深度任务讨论 (新版必需)
```bash
claude "我需要执行一个长时间任务(超过24小时)，请按照 TASK_DISCUSSION_TEMPLATE.md 开始详细的任务讨论阶段"
```

### 步骤3: 生成执行计划确认书
```bash
claude "基于我们的详细讨论，请按照 EXECUTION_PLAN_CONFIRMATION.md 生成完整的执行计划确认书"
```

### 步骤4: 执行前检查
```bash
claude "请按照 PRE_EXECUTION_CHECKLIST.md 执行启动前的最终检查"
```

### 步骤5: 启动任务执行
```bash
# 用户确认后启动执行
claude "我确认同意开始执行，请严格按照 EXECUTION_PLAN_CONFIRMATION.md 开始任务执行"
```

### 步骤6: 启动监控系统 (强烈推荐)
```bash
# 在新终端中启动监控界面
./scripts/execution-monitor.sh --interface

# 或使用后台监控模式
./scripts/execution-monitor.sh --background &
```

## 📋 完整使用流程

### 🎨 深度讨论阶段 (1-3小时)

#### 1. 任务目标深度讨论
Claude会按照 TASK_DISCUSSION_TEMPLATE.md 进行结构化讨论：
- **核心目标确认**: 项目的最终目标和成功标准
- **技术要求和约束**: 技术栈、性能、安全要求
- **范围和边界**: 必须包含和明确排除的内容
- **特殊注意点**: 用户特别强调的要求和偏好

#### 2. 实现细节讨论
- **架构和结构**: 整体设计方案和文件组织
- **质量标准**: 详细程度、错误处理、验证方式
- **用户体验**: 目标用户水平和示例复杂度要求
- **风险点识别**: 可能的技术难点和解决方案

#### 3. 歧义点澄清
- **关键决策确认**: 技术选择、架构方案等
- **边界情况处理**: 异常情况的处理策略
- **依赖关系确认**: 外部依赖和版本要求
- **用户最终确认**: 确保理解完全准确

### 📋 规划确认阶段 (1-2小时)

#### 1. 执行计划生成
基于讨论结果，Claude会生成：
- `EXECUTION_PLAN_CONFIRMATION.md`: 详细的执行计划确认书
- `PROJECT_PLAN.md`: 更新的项目规划文档
- `TASK_DEFINITIONS.md`: 具体的任务定义
- `QUALITY_STANDARDS.md`: 质量标准和验证方法

#### 2. 技术方案确认
- **架构设计**: 详细的技术架构和实现方案
- **执行计划**: 分阶段执行策略和时间安排
- **风险评估**: 已识别风险和应对策略
- **资源需求**: 系统资源和外部依赖需求

#### 3. 用户确认签署
- 用户仔细阅读执行计划确认书
- 确认技术方案符合预期
- 签署确认书授权开始执行

### 🔍 执行前检查阶段 (30分钟)

#### 1. 系统环境检查
```bash
# 检查系统状态
./scripts/execution-monitor.sh --check

# 验证依赖工具
which claude jq
```

#### 2. 完整性验证
按照 PRE_EXECUTION_CHECKLIST.md 执行26项检查：
- **规划文件检查**: 所有必需文件已创建且内容完整
- **技术环境检查**: 系统资源、网络连接、权限设置
- **数据状态检查**: 状态文件完整性和一致性
- **风险预案检查**: 已识别风险都有应对策略
- **用户确认检查**: 用户已明确授权开始执行

#### 3. 最终确认
- Claude执行自检确认
- 用户最终确认"同意开始执行"
- 所有检查项通过，准备启动

### 🤖 执行阶段 (AI自主 + 智能监控)

#### 1. 启动自动执行
```bash
claude "我确认同意开始执行，请严格按照 EXECUTION_PLAN_CONFIRMATION.md 开始任务执行"
```

#### 2. 启动监控系统 (新终端)
```bash
# 实时监控界面 (推荐)
./scripts/execution-monitor.sh --interface

# 或后台监控
./scripts/execution-monitor.sh --background &
```

#### 3. 自动执行过程
Claude会自动：
- 按顺序执行每个定义的任务
- 每完成一个任务进行自我验证
- **智能异常处理**: 自动检测和处理API错误、超时等
- **自动重试机制**: 智能重试可恢复的错误
- **创建恢复点**: 定期保存执行状态
- 实时更新执行状态和进度

#### 4. 监控和告警
监控系统会：
- **实时监控**: 系统资源、网络状态、任务进度
- **异常检测**: 自动识别需要关注的情况
- **智能告警**: 分级告警，避免告警疲劳
- **自动恢复**: 尝试自动解决常见问题
- **人工干预**: 必要时暂停等待人工处理

#### 5. 进度监控命令
```bash
# 查看执行状态
cat EXECUTION_STATUS.json | jq .

# 查看执行日志
tail -f EXECUTION_LOG.md

# 生成监控仪表板
./scripts/execution-monitor.sh --dashboard

# 查看重试统计
./scripts/smart-retry-handler.sh --stats
```

### ✅ 验收阶段 (人工检查)

#### 1. 完成报告
Claude会生成详细的执行报告：
- 完成的任务列表
- 质量评分统计
- 遇到的问题和解决方案
- 改进建议

#### 2. 质量验收
根据质量标准检查：
- 内容准确性
- 格式规范性
- 完整性验证
- 用户体验评估

## 🎯 实际使用案例

### 案例1: 文档生成项目
```bash
# 启动规划
claude "我想要为我的开源项目生成完整的技术文档，包括API文档、使用指南、开发指南等"

# 典型规划结果
- 项目模块: 6个主要模块
- 文档数量: 25个文档文件
- 执行时间: 6-8小时
- 质量标准: 技术准确性 + 实用性
```

### 案例2: 代码库重构
```bash
# 启动规划
claude "我想要重构我的TypeScript项目，升级到最新版本并优化代码结构"

# 典型规划结果
- 重构模块: 8个功能模块
- 升级任务: 12个具体任务
- 执行时间: 4-6小时
- 质量标准: 代码质量 + 性能优化
```

### 案例3: 学习材料制作
```bash
# 启动规划
claude "我想要制作一套React Native开发教程，从入门到实战项目"

# 典型规划结果
- 教程章节: 15个章节
- 实战项目: 3个项目案例
- 执行时间: 8-10小时
- 质量标准: 学习效果 + 实用价值
```

## ⚠️ 常见问题解决

### 问题1: 规划阶段不清晰
**症状**: 不知道如何回答Claude的规划问题
**解决方案**:
```
人类: 我不太确定具体的技术范围，你能给我一些建议吗？
Claude: 当然可以！根据你的项目类型，我建议以下技术范围...
[给出具体的建议选项]
```

### 问题2: 执行中断
**症状**: Claude执行过程中突然停止
**解决方案**:
```bash
# 重新启动并恢复
claude "根据 EXECUTION_STATUS.json 从中断点继续执行"

# 或者检查问题后重新开始
claude "检查执行中断的原因并重新开始"
```

### 问题3: 质量不达标
**症状**: 生成的内容质量不符合预期
**解决方案**:
```bash
# 调整质量标准
claude "当前生成的质量不达标，请调整 QUALITY_STANDARDS.md 中的标准并重新验证"

# 重新生成特定内容
claude "请重新生成 [特定模块] 的内容，提高质量标准"
```

### 问题4: 任务失败
**症状**: 某个任务执行失败
**解决方案**:
```bash
# 查看错误详情
cat ERROR_REPORT.md

# 手动处理后继续
claude "任务 [任务ID] 失败，我已经手动处理了问题，请继续执行"
```

## 🔧 高级使用技巧

### 1. 分阶段执行
对于大型项目，建议分阶段执行：
```bash
# 第一阶段
claude "执行第一阶段任务：基础框架搭建"

# 检查第一阶段结果后
claude "执行第二阶段任务：核心内容生成"
```

### 2. 质量标准定制
根据项目特点调整质量标准：
```markdown
# 在 QUALITY_STANDARDS.md 中
技术准确性权重: 50% (对于技术文档)
实用性权重: 40% (对于教程类内容)
格式规范权重: 10% (对于内部文档)
```

### 3. 异常处理预配置
提前定义可能的异常情况：
```markdown
# 在 TASK_DEFINITIONS.md 中
可能异常1: 网络连接不稳定
- 处理策略: 自动重试3次
- 后备方案: 使用本地缓存

可能异常2: API返回格式变化
- 处理策略: 暂停并等待人工处理
- 应急措施: 使用备用数据源
```

## 📊 效果评估

### 成功指标
- **执行效率**: 任务完成率 > 95%
- **质量评分**: 平均质量分数 > 8.0/10
- **时间准确性**: 实际执行时间与预估时间误差 < 20%
- **异常处理**: 自动恢复率 > 80%

### 持续改进
- 记录每次执行的经验教训
- 优化任务定义和质量标准
- 完善异常处理机制
- 积累项目特定的最佳实践

## 🎯 最佳实践

### 1. 规划阶段
- **明确目标**: 越具体的目标，越好的执行效果
- **充分沟通**: 不要害怕提出疑问和要求
- **质量优先**: 在规划阶段就明确质量标准
- **风险评估**: 提前识别可能的问题

### 2. 执行阶段
- **信任但验证**: 相信Claude的能力，但要定期检查进度
- **及时干预**: 发现问题时及时介入处理
- **保持耐心**: 复杂项目需要时间，不要急于求成
- **记录经验**: 记录遇到的问题和解决方案

### 3. 验收阶段
- **全面检查**: 不要只看最终结果，要检查整个过程
- **用户视角**: 从最终用户的角度评估质量
- **持续改进**: 根据验收结果优化工作流程
- **文档完善**: 记录使用经验，为后续项目参考

## 🎉 开始使用

现在你已经了解了完整的工作流系统，可以开始在你的项目中使用：

```bash
# 1. 复制模板
cp -r claude-workflow-template/template-docs/ ./
cp -r claude-workflow-template/scripts/ ./

# 2. 开始你的第一个自动化项目
claude "我想要使用工作流系统来执行 [你的项目目标]，请帮我制定详细的执行计划"
```

祝你使用愉快！如有任何问题，可以随时查看模板文件中的详细说明或参考examples/中的实际案例。

---

**版本**: 1.0
**更新时间**: 2025-10-04
**支持**: Claude Code CLI