# Claude Code CLI 模式切换器使用指南

## 🎯 功能概述

这个模式切换器让您可以在当前终端会话中快速切换Claude Code CLI的工作模式，实现：

- **确认模式**: 短时任务，手动确认（默认模式）
- **自动化模式**: 长时任务，自动确认（24小时不间断工作）

## 🚀 快速开始

### 1. 加载模式切换器
```bash
source claude-mode-switcher.sh
```

### 2. 查看可用命令
```bash
claude-mode-help
```

### 3. 切换模式
```bash
# 切换到自动化模式（适合长时任务）
claude-auto

# 切换回确认模式（适合短时任务）
claude-confirm
```

## 📝 详细使用说明

### 模式切换命令

| 命令 | 功能 | 适用场景 |
|------|------|----------|
| `claude-auto` | 启用自动化模式 | 长时任务、批量处理 |
| `claude-confirm` | 启用确认模式 | 短时任务、精细操作 |
| `claude-mode-status` | 查看当前模式 | 检查状态 |
| `run-auto-claude <command>` | 直接运行自动化任务 | 一次性自动化执行 |
| `claude-mode-help` | 显示帮助信息 | 查看使用说明 |

### 快捷别名

切换器还提供了快捷别名：
- `auto` = `claude-auto`
- `confirm` = `claude-confirm`
- `status` = `claude-mode-status`
- `help` = `claude-mode-help`
- `run` = `run-auto-claude`

## 🎨 使用示例

### 示例1：短时任务（确认模式）
```bash
# 加载切换器（默认确认模式）
source claude-mode-switcher.sh

# 执行短时任务，需要手动确认
claude "修复一个简单的bug"

# 检查当前模式
status
```

### 示例2：长时任务（自动化模式）
```bash
# 加载切换器
source claude-mode-switcher.sh

# 切换到自动化模式
claude-auto

# 执行长时任务，自动确认
claude "按照README.md完成整个Next.js学习模块"

# 检查模式状态
status
```

### 示例3：一次性自动化任务
```bash
# 加载切换器
source claude-mode-switcher.sh

# 直接执行自动化任务（无需切换模式）
run-auto-claude "执行Dev Quest项目的主控制任务"
```

### 示例4：模式切换流程
```bash
# 加载切换器
source claude-mode-switcher.sh

# 开始是确认模式
claude "快速检查一下代码"

# 切换到自动化模式执行长时任务
claude-auto
claude "完成整个02-nextjs-frontend模块"

# 任务完成后切换回确认模式
claude-confirm
claude "验证一下刚才的任务结果"
```

## 🔒 安全特性

### 会话隔离
- ✅ 只在当前终端会话生效
- ✅ 不修改系统配置文件
- ✅ 不影响其他终端会话
- ✅ 会话结束后自动清理

### 环境隔离
- ✅ 使用专用的环境变量前缀
- ✅ 自动清理机制
- ✅ 不会污染系统环境

### 错误处理
- ✅ 自动检测Claude CLI是否可用
- ✅ 优雅的错误提示
- ✅ 防止意外操作

## 🛠️ 技术细节

### 工作原理
1. **函数包装**: 使用shell函数包装原始claude命令
2. **输入流**: 自动化模式通过管道提供确认输入
3. **环境变量**: 使用`CLAUDE_AUTO_MODE`标志控制模式
4. **清理机制**: 通过trap确保会话结束时清理

### 自动确认序列
自动化模式会自动发送以下确认输入：
- `y` - 确认文件编辑
- `yes` - 确认工具使用
- `continue` - 继续执行
- `proceed` - 确认计划执行

### 清理机制
会话结束时自动清理：
- 移除包装函数
- 清理环境变量
- 取消别名定义

## ⚠️ 注意事项

### 使用建议
1. **谨慎使用自动化模式**: 确保任务正确性后再启用
2. **定期检查进度**: 即使在自动化模式下也要监控执行进度
3. **保持会话开启**: 自动化任务执行期间保持终端会话开启
4. **备份重要数据**: 执行重要任务前先备份数据

### 限制说明
1. **会话依赖**: 每次新开终端会话都需要重新加载切换器
2. **单会话限制**: 模式设置只在当前会话中有效
3. **Claude CLI依赖**: 需要正确安装Claude CLI工具
4. **终端兼容**: 主要测试于bash，其他shell可能需要调整

### 最佳实践
1. **任务测试**: 先用确认模式测试任务，再切换到自动化模式
2. **小批量验证**: 对于长时任务，建议先小批量验证
3. **定期保存**: 在长时任务执行过程中定期保存进度
4. **监控日志**: 关注任务执行日志，及时发现异常

## 🆘 故障排除

### 常见问题

**Q: 加载切换器后claude命令不工作**
A: 确保Claude CLI已正确安装，使用`command -v claude`检查

**Q: 自动化模式没有自动确认**
A: 检查是否正确加载了切换器，使用`claude-mode-status`查看状态

**Q: 会话结束后设置仍然存在**
A: 这是正常的，系统级CLAUDE变量会保留，但模式切换器的变量会被清理

**Q: 如何停止正在执行的自动化任务**
A: 使用Ctrl+C停止任务，然后切换回确认模式

### 调试方法
```bash
# 检查环境变量
env | grep CLAUDE

# 检查函数定义
declare -f claude

# 检查别名
alias | grep claude
```

## 🎉 总结

Claude Code CLI模式切换器提供了：

- ✅ **一键切换**: 在确认模式和自动化模式间快速切换
- ✅ **会话隔离**: 只在当前终端会话生效
- ✅ **无配置污染**: 不修改系统配置文件
- ✅ **完全控制**: 用户完全掌控工作模式
- ✅ **安全可靠**: 自动清理机制，无残留影响

现在您可以轻松地在短时精细操作和长时自动化任务之间切换，享受高效开发的便利！